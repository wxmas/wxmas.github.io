---
layout: post
title: 零值比较--BOOL，int，float，指针变量与零值比较的if语句
date: 2017-10-12 18:51
categories:
- C
- C++
tags: 
- C
- C++
---

这是程序员面试的一道常见题，也是个C++基础问题。若只在大学里看过几本基础的编程入门书，看见这道题可能会觉得奇怪，不就是和0比较吗，直接拿出来比就是了，其实非也。下文引自google搜索结果，出处不详，高手可以无视，菜菜留下，记得做好笔记。
首先给个提示：题目中要求的是零值比较，而非与`0`进行比较，在C++里“零值”的范围可就大了，可以是`0`，`0.0`，`FALSE`或者“空指针”。

## int型变量`n`与“零值”比较的`if`语句 ##

{% highlight C linenos %}
if ( n == 0 )
if ( n != 0 )
如下写法均属不良风格：
if ( n )    // 会让人误解 n 是布尔变量
if ( !n  )
{% endhighlight %}

## float x 与“零值”比较的 if 语句 ##

千万要留意，无论是`float`还是`double`类型的变量，都有精度限制，都不可以用“==”或“！=”与任何数字比较，应该设法转化成“>=”或“<=”形式。(为什么？文章之后有详细的讨论，可参考)
假设浮点变量的名字为`x`，应当将

**if (x == 0.0)  // 隐含错误的比较**
**转化为**
**if ((x>=-EPSINON) && (x<=EPSINON))**
其中EPSINON 是允许的误差（即精度）。

标准答案示例：

{% highlight C linenos %}
const float EPSINON = 0.00001;
if ((x >= - EPSINON) && (x <= EPSINON)
如下是错误的写法：
if (x == 0.0) 
if (x != 0.0)
{% endhighlight %}

## char *p 与“零值”比较的 if 语句 ##

{% highlight C linenos %}
if (p == NULL)
if (p != NULL)
如下写法均属不良风格：
if (p == 0)   // 容易让人误解p是整型变量
if (p != 0) 
if (p)        // 容易让人误解p是bool型变量
if (!p)
{% endhighlight %}

以上的不良风格很多都能通过编译，但是语句并不能很好的表达与零值进行比较的逻辑依据。一般的，如果想用`if`语句判断一个变量的真假，应该直接使用`if（var）`、`if（！var）`，表明此`if`语句的功能为“逻辑”判断；如果想用`if`语句判断一个数值型变量（`short`、`int`、`long`等），应该用`if（var==0）`，表明此`if`语句是将变量与`0`进行“数值”上的比较；而检视指针是否为空则适宜用`if（var==NULL）`，这是一种很好的编程习惯。

浮点型变量并不精确，所以不可将`float`变量用“==”或“！=”与数字比较，应该设法转化成“>=”或“<=”形式。如果写成`if （x == 0.0）`，则判为错。以下给出详细原因：

浮点数在内存中的存贮机制和整型数不同，有舍入误差，在计算机中用以近似表示任意某个实数。具体的说，这个实数由一个整数或定点数（即尾数）乘以某个基数（计算机中通常是`2`）的整数次幂得到，这种表示方法类似于基数为`10`的科学记数法。

所以浮点数在运算过成功运算通常伴随着因为无法精确表示而进行的近似或舍入。但是这种设计的好处是可以在固定的长度上存储更大范围的数。 

例如，一个指数范围为`±4`的`4`位十进制浮点数可以用来表示`43210`，`4.321`或`0.0004321`，但是没有足够的精度来表示`432.123`和`43212.3`（必须近似为`432.1`和`43210`）。当然，实际使用的位数通常远大于`4`。 
所以浮点数不能够判断相等，像`if(x==0)`的这样的编码是不总是正确的，我们在判断浮点数相等时，推荐用范围来确定，若x在某一范围内，我们就认为相等，至于范围怎么定义，要看实际情况而已了，`float`，和`double`各有不同 
所以`const float EPSINON = 0.00001;`
`if ((x >= - EPSINON) && (x <= EPSINON)` 这样判断是可取的 
至于为什么取`0.00001`，可以自己按实际情况定义。